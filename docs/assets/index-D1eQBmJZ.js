(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))n(e);new MutationObserver(e=>{for(const t of e)if(t.type==="childList")for(const o of t.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function i(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?t.credentials="include":e.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function n(e){if(e.ep)return;e.ep=!0;const t=i(e);fetch(e.href,t)}})();const v=["des","tout","grand","petit","même","autre","seul","jeune","premier","bon","quel","beau","vieux","noir","nouveau","dernier","blanc","cher","long","pauvre","plein","vrai","toute","bas","gros","doux","heureux","haut","profond","rouge","ne","pas","plus","bien","si","là","même","tout","encore","aussi","peu","alors","toujours","jamais","non","très","ainsi","moins","ici","oui","et","que","comme","mais","ou","quand","si","puis","donc","car","le","la","les","un","une","des","ce","cette","ces","mon","ton","son","notre","votre","leur","je","tu","il","elle","nous","vous","ils","elles","me","te","se","lui","leur","y","en"],E=a=>{const s={fr:{words:v,commonWords:["le","la","les","un","une","des","et","ou","je","tu","il","elle","nous","vous"],count:0,commonCount:0},en:{words:["the","a","an","and","or","i","you","he","she","we","they","this","that","what"],commonWords:["the","a","an","and","or","i","you","he","she","we"],count:0,commonCount:0},es:{words:["el","la","los","las","un","una","unos","y","o","yo","tu","él","ella","nosotros"],commonWords:["el","la","los","las","un","una","unos","y","o","yo"],count:0,commonCount:0}},i=a.toLowerCase().split(/\s+/),n=i.length;i.forEach(r=>{for(let c in s){const l=s[c];l.commonWords.includes(r)?(l.commonCount++,l.count++):l.words.includes(r)&&l.count++}});const e={};for(let r in s){const c=s[r];e[r]=(c.commonCount*2+c.count)/n*100}let t=Object.keys(e).reduce((r,c)=>e[r]>e[c]?r:c),o=e[t];return{dominantLanguage:t,dominantPercentage:o,percentages:e}},f={detectLanguage:E};window.languageDetection=f;const h=()=>{if(typeof window>"u"||typeof window.speechSynthesis>"u")throw new Error("Speech synthesis not supported in this browser");return window.speechSynthesis};let g=null;const y=()=>{const a=h();return new Promise((s,i)=>{let n=a.getVoices();if(n.length>0){g=n,console.log("Voices loaded immediately:",n.length),s(n);return}let e=0;const t=10,o=100,r=()=>(n=a.getVoices(),n.length>0?(g=n,console.log("Voices loaded after polling:",n.length),s(n),!0):!1),c=()=>{if(e>=t){console.log("Polling failed, setting up voiceschanged listener"),l();return}e++,r()||setTimeout(c,o)},l=()=>{console.log("Setting up voiceschanged event listener");const d=()=>{const m=a.getVoices();m.length>0&&(g=m,console.log("Voices loaded from event:",m.length),a.removeEventListener("voiceschanged",d),s(m))};a.addEventListener("voiceschanged",d),setTimeout(()=>{a.removeEventListener("voiceschanged",d),n=a.getVoices(),n.length>0?(g=n,console.log("Voices loaded in final attempt:",n.length),s(n)):(console.error("Failed to load voices after all attempts"),i(new Error("Could not load speech synthesis voices")))},3e3)};c()})},L=async()=>{const a=h();try{console.log("Initializing speech synthesis...");const s=await y();if(s.length===0)throw new Error("No voices available after initialization");console.log("Available voices:",s.map(n=>({name:n.name,lang:n.lang,default:n.default?"yes":"no",localService:n.localService?"yes":"no"})));const i={en:["en-US","en-GB","en","en-CA"],fr:["fr-FR","fr-CA","fr","fra","fr-BE","fr-CH"],es:["es-ES","es-MX","es","spa","es-AR","es-CL"]};for(const[n,e]of Object.entries(i)){const t=s.filter(o=>e.some(r=>o.lang.toLowerCase().startsWith(r.toLowerCase())));console.log(`Found ${t.length} voices for ${n}:`,t.map(o=>`${o.name} (${o.lang})`))}return a}catch(s){throw console.error("Speech synthesis initialization failed:",s),new Error("Speech synthesis initialization failed: "+s.message)}},w=(a,s)=>{const i=h(),n={en:["en-US","en-GB","en","en-CA"],fr:["fr-FR","fr-CA","fr","fra","fr-BE","fr-CH"],es:["es-ES","es-MX","es","spa","es-AR","es-CL"]},e=g||i.getVoices();console.log("Available voices:",e.map(o=>({name:o.name,lang:o.lang})));let t=e.filter(o=>{const r=n[a].some(l=>o.lang.startsWith(l)),c=s==="any"||s==="female"&&(o.name.toLowerCase().includes("female")||o.name.toLowerCase().includes("femme"))||s==="male"&&(o.name.toLowerCase().includes("male")||o.name.toLowerCase().includes("homme"));return r&&c});return t.length===0&&(t=e.filter(o=>n[a].some(r=>o.lang.startsWith(r)))),console.log(`Found ${t.length} voices for language ${a}:`,t.map(o=>({name:o.name,lang:o.lang}))),t},b=async(a,s,i="male")=>{const n=h();if(!g)try{await y()}catch(e){throw console.error("Failed to load voices:",e),new Error("Unable to load speech synthesis voices")}return new Promise((e,t)=>{n.cancel();const o=w(s,i);if(o.length===0){t(new Error(`No voice found for language ${s}. Available voices: ${n.getVoices().map(c=>`${c.name} (${c.lang})`).join(", ")}`));return}const r=new SpeechSynthesisUtterance(a);r.voice=o[0],r.lang=o[0].lang,r.rate=1,r.pitch=1,r.onend=()=>{e()},r.onerror=c=>{t(new Error(`Speech synthesis error: ${c.error}`))},n.speak(r)})},p={init:L,speak:b,getVoices:w};document.addEventListener("DOMContentLoaded",()=>{p.init().then(()=>{u("Speech synthesis ready"),document.getElementById("speak-button").disabled=!1}).catch(t=>{u(`Error: ${t.message}`,"error"),document.getElementById("speak-button").disabled=!0});const a=document.getElementById("text-input"),s=document.getElementById("voice-select"),i=document.getElementById("speak-button");document.getElementById("status-message");const n=document.getElementById("word-count"),e=document.getElementById("language-stats");a.addEventListener("input",()=>{const t=a.value.trim(),r=t.split(/\s+/).filter(c=>c.length>0).length;if(n.textContent=r,r>500){u("Error: Text exceeds 500 words limit","error"),i.disabled=!0;return}if(r>0){const{dominantLanguage:c,dominantPercentage:l,percentages:d}=f.detectLanguage(t);if(e.innerHTML=`
                Detected languages:<br>
                French: ${d.fr.toFixed(1)}%<br>
                English: ${d.en.toFixed(1)}%<br>
                Spanish: ${d.es.toFixed(1)}%
            `,l<5){u("Error: No dominant language detected (threshold: 5%)","error"),i.disabled=!0;return}i.disabled=!1,u("")}else e.innerHTML="",i.disabled=!0}),i.addEventListener("click",async()=>{const t=a.value.trim();if(!t)return;const{dominantLanguage:o}=f.detectLanguage(t),r=s.value;i.disabled=!0,u("Reading text...");try{await p.speak(t,o,r),u("Finished reading")}catch(c){u(`Error: ${c.message}`,"error")}finally{i.disabled=!1}})});function u(a,s="info"){const i=document.getElementById("status-message");i.textContent=a,i.className=`status ${s}`}
